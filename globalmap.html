<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Map with D3.js</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        .province {
            stroke: #fff;
            stroke-width: 0.5px;
        }

        .legend {
            font-size: 12px;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            width: auto;
            padding: 5px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <svg width="960" height="600"></svg>

    <script>
        var width = 960;
        var height = 600;

        var svg = d3.select("svg")
                    .attr("width", width)
                    .attr("height", height);

        var projection = d3.geoMercator()
                           .center([0, 0]) // Tọa độ trung tâm, ở đây mặc định để [0, 0]
                           .scale(150)
                           .translate([width / 2, height / 2]);

        var path = d3.geoPath().projection(projection);

        function rowConverter(row) {
            return {
                country: row.country,
                year: +row.year,
                population: +row.population,
                pop_density: +row.pop_density,
                net_migration: +row.net_migration,
                migration_perc: +row.migration_perc,
                iso3c: row.iso3c,
                iso2c: row.iso2c,
                region: row.region,
                adminregion: row.adminregion,
                incomeLevel: row.incomeLevel,
                lendingType: row.lendingType,
                capitalCity: row.capitalCity,
                longitude: +row.longitude,
                latitude: +row.latitude
            };
        }
        // Load dữ liệu GeoJSON
        d3.json("https://raw.githubusercontent.com/ITITIU20153/DSDC-project/main/Data/global_final.json").then(function(data) {
            // Tạo scale màu
            var color = d3.scaleQuantize()
                          .domain([0, 100]) // Domain của dữ liệu màu, ví dụ từ 0 đến 100
                          .range(d3.schemeBlues[9]); // Màu sắc cho scale

            // Dữ liệu mẫu (tạm thời random)
            var sampleData = {};
            data.features.forEach(function(d) {
                sampleData[d.properties.Name] = Math.random() * 100; // Tạo dữ liệu ngẫu nhiên từ 0 đến 100
            });

            // Vẽ các path trên bản đồ từ dữ liệu GeoJSON
            svg.append("g")
               .selectAll("path")
               .data(data.features)
               .enter().append("path")
               .attr("class", "province")
               .attr("d", path)
               .style("fill", function(d) {
                   var value = sampleData[d.properties.Name]; // Lấy giá trị dựa vào tên đối tượng
                   return color(value); // Trả về màu sắc từ scale color
               })
               .on("mouseover", function(event, d) {
                    const countryData = data.find(item => item.iso3c === d.properties.iso_a3);
                    tooltip.style("visibility", "visible")
                           .html(countryData ? `${countryData.Name}: Population ${countryData.POP_EST}` : "Unknown")
                           .style("left", (event.pageX + 10) + "px")
                           .style("top", (event.pageY - 15) + "px");
               })
               .on("mouseout", function() {
                    tooltip.style("visibility", "hidden");
               });

            // Tooltip
            const tooltip = d3.select("body").append("div")
                               .attr("class", "tooltip")
                               .style("visibility", "hidden");

            // Tạo legend
            var legend = svg.selectAll(".legend")
                            .data(color.range().map(function(d) {
                                d = color.invertExtent(d);
                                if (d[0] == null) d[0] = color.domain()[0];
                                if (d[1] == null) d[1] = color.domain()[1];
                                return d;
                            }))
                            .enter().append("g")
                            .attr("class", "legend")
                            .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

            legend.append("rect")
                  .attr("x", width - 18)
                  .attr("width", 18)
                  .attr("height", 18)
                  .style("fill", function(d) { return color(d[0]); });

            legend.append("text")
                  .attr("x", width - 24)
                  .attr("y", 9)
                  .attr("dy", ".35em")
                  .style("text-anchor", "end")
                  .text(function(d) { return Math.round(d[0]) + "-" + Math.round(d[1]); });
        }).catch(function(error){
            console.error("Error loading or parsing data:", error);
        });
    </script>
</body>
</html>
